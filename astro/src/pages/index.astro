---
import { getCollection } from "astro:content";
import Layout from "@layouts/Layout.astro";
import Header from "@components/Header.astro";
import Footer from "@components/Footer.astro";
import LinkButton from "@components/LinkButton.astro";
import Hr from "@components/Hr.astro";
import Card from "@components/Card";
import Socials from "@components/Socials.astro";
import getSortedPosts from "@utils/getSortedPosts";
import slugify from "@utils/slugify";
import { SOCIALS } from "@config";

const posts = await getCollection("blog");

const sortedPosts = getSortedPosts(posts);
const featuredPosts = sortedPosts.filter(({ data }) => data.featured);

const socialCount = SOCIALS.filter(social => social.active).length;
---

<Layout>
  <Header />
  <main id="main-content">
    {
      featuredPosts.length > 0 && (
        <>
          <section id="featured"  class="prose">
            <h2>featured posts</h2>
            <ul>
              {featuredPosts.map(({ data }) => (
                <Card
                  href={`/posts/${slugify(data)}`}
                  frontmatter={data}
                  secHeading={false}
                />
              ))}
            </ul>
            <div class="all-posts-btn-wrapper">
              <LinkButton href="/posts">
                All Posts
                <svg xmlns="http://www.w3.org/2000/svg">
                  <path d="m11.293 17.293 1.414 1.414L19.414 12l-6.707-6.707-1.414 1.414L15.586 11H6v2h9.586z" />
                </svg>
              </LinkButton>
            </div>
          </section>
        </>
      )
    }

    <section id="about" class="prose">
      <h2>about</h2>
      <img src="./profile.jpg" />
      <div class="about-content">
        <p>
          AstroPaper is a minimal, responsive, accessible and SEO-friendly Astro
          blog theme. This theme follows best practices and provides accessibility
          out of the box. Light and dark mode are supported by default. Moreover,
          additional color schemes can also be configured.
        </p>
        <p class="text-center w-full sm:w-42 md:w-full")>
          <a href="/about">read more</a>
        </p>
      {
        // only display if at least one social link is enabled
        socialCount > 0 && (
          <div class="social-wrapper">
            <b>find me around:</b>
            <Socials />
          </div>
        )
      }
      </div>
    </section>

    <section id="budget">
      <h3>2024 food budget</h3>
      <p>groceries</p>
      <div id="grocery-bar"></div>
      <p>eating out</p>
      <div id="restaurant-bar"></div>
      <div class="budget-btn-wrapper">
        <LinkButton href="/posts">
          read more about the project
          <svg xmlns="http://www.w3.org/2000/svg"
            ><path
              d="m11.293 17.293 1.414 1.414L19.414 12l-6.707-6.707-1.414 1.414L15.586 11H6v2h9.586z"
            ></path>
          </svg>
        </LinkButton>
      </div>
    </section>

    <section id="recent-posts" class="prose max-width-none">
      <h2>recent posts</h2>
      <ul>
        {
          sortedPosts
            .filter(({ data }) => !data.featured)
            .map(
              ({ data }, index) =>
                index < 4 && (
                  <Card
                    href={`/posts/${slugify(data)}`}
                    frontmatter={data}
                    secHeading={false}
                  />
                )
            )
        }
      </ul>
      <div class="all-posts-btn-wrapper">
        <LinkButton href="/posts">
          All Posts
          <svg xmlns="http://www.w3.org/2000/svg"
            ><path
              d="m11.293 17.293 1.414 1.414L19.414 12l-6.707-6.707-1.414 1.414L15.586 11H6v2h9.586z"
            ></path>
          </svg>
        </LinkButton>
      </div>
    </section>
    <section id="categories">
      <a href="/tags/eat"><div id="eat">eat</div></a>
      <a href="/tags/garden"><div id="garden">garden</div></a>
      <a href="/tags/build"> <div id="build">build</div></a>
      <a href="/tags/create"><div id="create">create</div></a>
      <a href="/tags/travel"><div id="travel">travel</div></a>
      <a href="/tags/money"><div id="money">spend/save</div></a>
      <a href="/tags/rest"><div id="rest">rest</div></a>
    </section>
    <section id="products">
      <h2>things I like</h2>
    </section>
  </main>

  <Footer />
</Layout>

<style>
  /* ===== Main Content ===== */
  #main-content {
    @apply flex flex-wrap w-full box-content;
  }
  /* ===== Featured & Recent Posts Sections ===== */
  #featured,
  #recent-posts {
    @apply pb-6 pt-12 w-full sm:ml-12 md:max-w-3xl md:mx-16;
  }
  #featured h2,
  #recent-posts h2 {
    @apply text-2xl font-semibold tracking-wide;
  }
  .all-posts-btn-wrapper {
    @apply my-4 text-center;
  }
  /* ===== About Section ===== */
  #about {
    @apply flex flex-wrap bg-border/50 pb-4 sm:max-w-none sm:my-4 md:bg-fill md:w-1/5 md:mx-4;
  }
  #about h2 {
    @apply w-full my-4 inline-block text-xl text-center sm:my-8 sm:text-2xl;
  }
  #about img {
    @apply w-48 sm:w-52 md:ml-0 md:w-60;
  }
  .about-content {
    @apply mt-2 mb-4 sm:w-7/12 md:w-full;
  }
  .social-wrapper {
    @apply mt-2 w-full flex flex-col justify-center items-center;
  }
  .social-links {
    @apply mb-1 mr-2 whitespace-nowrap sm:mb-0;
  }
</style>
