---
import { SITE } from "@config";
import Posts from "@layouts/Posts.astro";
import getSortedPosts from "@utils/getSortedPosts";
import getPageNumbers from "@utils/getPageNumbers";
import { getAllPosts } from '../../lib/api.js';

// import { getCollection } from "astro:content";

let posts = await getAllPosts();
posts = posts.map((post) => {
    return {
        title: post.title,
        slug: post.slug.current,
        description: post.description[0].children[0].text,
        tags: post.tags,
        tagData: post.tagData,
        author: post.author,
        body: post.body,
        featured: post.featured,
        publishedAt: post.publishedAt,
        id: post._id,
    }
})
console.log(posts[0]);
// const sortedPosts = getSortedPosts(posts);

const totalPages = getPageNumbers(posts.length);

const paginatedPosts = posts.slice(0, SITE.postPerPage);
---

<Posts posts={paginatedPosts} pageNum={1} totalPages={totalPages.length} />
